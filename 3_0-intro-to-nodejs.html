<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>3 Intro to Node.js | Headless Training Book</title>

    <!-- Styles and fonts -->
    <link href="themes/epsilon/stylesheets/epsilon.css" rel="stylesheet" type="text/css" />
    <link href="themes/epsilon/stylesheets/syntax.css" rel="stylesheet" type="text/css" />
    <link href='//fonts.googleapis.com/css?family=Lato:100,300,400,700|Noticia+Text:400,400italic,700,700italic&subset=latin,latin-ext,vietnamese' rel='stylesheet' type='text/css'>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <script src="themes/epsilon/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="x3_0-intro-to-nodejs epsilon">
    <div class="page-wrapper">

      <a id="menu-toggle" class="menu-toggle" href="#sidr"><span class="bitcon-list"></span><span class="menu-toggle-text">Toggle Menu</span></a>
      <header class="page-header" role="banner">
<a class="invisilink" href="./">            <span class="book-title">Headless Training Book</span>
</a>        <span class="book-author">by Michal Minecki</span>
      </header>

        <div class="content-wrapper clearfix">

          <!--[if lt IE 7]>
              <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
          <![endif]-->

          <section class="main-content" role="main">
            <div class="main-content-source">
              <h1>3 Intro to Node.js</h1>

<p>At the end of this section you&rsquo;ll have a basic understanding of Node.js®, Promises, and basic async concepts.</p>

<h2>Outline</h2>

<ul>
<li>What is Node.js</li>
<li>Events, Threads, and Concurrency</li>
<li>Why Node?</li>
</ul>

<h2>What is Node.js? An Introduction.</h2>

<blockquote>
<p>Node.js® is a platform built on Chrome&rsquo;s JavaScript runtime for easily building fast, scalable network applications. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices.</p>
</blockquote>

<h2>Events, threads, concurrency, what?</h2>

<p>The traditional concurrency model is to spawn a new child process to serve each connection. The parent process will remain available for listening to new connections. Each new connection results in the creation of a child process dedicated to it.</p>

<blockquote>
<p>This gets expensive.</p>
</blockquote>

<p>The same code is running in each process (or each thread) but from the OS perspective they are different tasks. Multi-tasking is achieved through CPU-time multiplexing also known as time-sharing.</p>

<p><a href="http://en.wikipedia.org/wiki/Scheduling_%28computing%29">Scheduling</a></p>

<blockquote>
<p>And it gets worst if the processes need to wait for something.</p>
</blockquote>

<h3>Wait &amp; Blocking</h3>

<p>There are many occasions on which a process or a thread will have to wait. It will wait for some external events to be completed before they can continue. Such occasions are IO. Blocking IO (or synchronous IO) will tie up the system resources as the waiting processes cannot be used for some other action.</p>

<p>However the system (your OS) is not stuck while IO is happening. The system is going to interrupt the process waiting for an IO operation, allowing the CPU to be used by another process.</p>

<h3>Events!</h3>

<p>The alternative is to use an event-driven model. This has proved useful in many products such as Nginx, Twisted, or EventMachine.</p>

<p>In an event model, everything runs in one process, one thread. Instead of spawning a new process/thread for each connection request, a event is emitted and the appropriate callback for that event is invoked.</p>

<blockquote>
<p>Callback hell.</p>
</blockquote>

<p>In event-driven model, all the events are treated by a gigantic loop know as the event-loop.</p>

<ul>
<li>Requests, etc. arrive</li>
<li>Added to the <em>event loop</em></li>
<li>Each event registers a callback, and executes it operation.</li>
<li>Operation completes and triggers the callback.</li>
<li>Next event is processed.</li>
</ul>

<blockquote>
<p>Imagine a king with servants.</p>
</blockquote>

<p>Every morning all the servants line up, one at a time they come into his throne room. They report on what they&rsquo;ve done, sometimes the king gives them more to do. Always one at a time, so the king can focus.</p>

<h2>Why is PHP &amp; Drupal bad at handling concurrency?</h2>

<p>Drupal has a large memory foot print. You might need to allocate 100mb just to serve some JSON.</p>

<blockquote>
<p>Exaggerated. Kinda.</p>
</blockquote>

<p>However, everything happens in order. Each IO operation blocks all subsequent ones. A <em>100ms</em> request to the DB will block process execution.</p>

<h2>Why Node?</h2>

<p>Chrome&rsquo;s JavaScript runtime is called V8, it&rsquo;s one of the reasons Chrome is considered so fast. Node.js leverages V8&rsquo;s speed on the server. Only one thing gets executed at a time, but libraries allow I/O or other intensive tasks to be executed asynchronously so the script doesn&rsquo;t need to wait for them to finish.</p>

<ul>
<li>Rapid prototyping</li>
<li><strong>API Glue</strong></li>
<li>Queue&#39;ish stuff</li>
<li>Message passing</li>
</ul>

            </div>
            <nav class="main-content-nav clearfix" role="navigation">
              <ul>
                <li><a class="previous" href="2_1-API-Best-Practices.html">Previous</a></li>
                <li><a class="next" href="4_0-introduction-to-express.html">Next</a></li>
              </ul>
            </nav>
          </section>

          <aside id="sidr" class="aside-content" role="complementary">
            <div class="aside-wrapper">

              <div class="block table-of-contents">
                <h3>Table of Contents</h3>
                <nav role="navigation">
                  <ul>
                    <li class='child '><a href="./">Headless Drupal Training - DrupalCon Barcelona 2015</a></li><li class='child '><a href="1_0-introduction-to-headless-drupal.html">1 Introduction to Headless Drupal</a></li><li class='child '><a href="1_5-using-APIs.html">1.5 What exactly is a REST API?</a></li><li class='child '><a href="1_6-API-tools.html">1.6 API Tools</a></li><li class='child '><a href="2_0-drupal-services.html">2 Drupal Services</a></li><li class='child '><a href="2_1-API-Best-Practices.html">2.1 API Best Practices</a></li><li class='child active'><a href="3_0-intro-to-nodejs.html">3 Intro to Node.js</a></li><li class='child '><a href="4_0-introduction-to-express.html">4 Intro to ExpressJS</a></li><li class='child '><a href="5_0-caching-drupal-content-in-nodejs.html">5 Caching Drupal Content in Node.js</a></li><li class='child '><a href="6_0-reference-implementation.html">6 Reference implementation introduction</a></li><li class='child '><a href="7_0-headless-ahas.html">7 Headless A-ha&rsquo;s</a></li><li class='child '><a href="8_0-strategies-for-user-generated-content.html">8 Strategies for User Generated Content</a></li>
                  </ul>
                </nav>
              </div>

              <div class="block open-source">
                <h3>This book is open source</h3>
                <p>The source of this book is <a href="https://github.com/mirzu/headless-training-book">hosted on Github</a>. Go, ahead. Check it out.</p>
              </div>

              <!--
              <div class="block downloads">
                <h3>Downloads</h3>
                <p>Download this book in
                    <a href="#">PDF</a>, <a href="#">mobi</a>, and <a href="#">epub</a>
                  form for free.
                </p>
              </div>

              <div class="block translations">
                <h3>Book translations</h3>
                <p>This book is translated into
                  <a href="#">Spanish</a>
                  and <a href="#">English</a>.
                  You can help with more translations <a href="https://github.com/mirzu/headless-training-book">on Github</a>.
                </p>
              </div>
              -->

              <div class="block license">
                <h3>License</h3>
                <p>This book is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">Attribution-NonCommercial-ShareAlike</a> license.</p>
              </div>

            </div><!-- end aside-wrapper -->
          </aside>

        </div><!-- end content-wrapper -->

      <footer class="page-footer">
        <div class="footer-wrapper">
          <small class="small-text">Made with <a href="http://bitbooks.cc">Bitbooks</a></small>
        </div><!-- end footer-wrapper -->
      </footer>

    </div><!-- end page-wrapper -->

    <!-- include scripts just before the close of the body tag -->
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="themes/epsilon/javascripts/jquery.sidr.min.js" type="text/javascript"></script>
    <script src="themes/epsilon/javascripts/anchor.min.js" type="text/javascript"></script>
    <script src="themes/epsilon/javascripts/epsilon.js" type="text/javascript"></script>
  </body>
</html>